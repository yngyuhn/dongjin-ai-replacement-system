# 侗锦AI替换系统

一个基于深度学习的传统纹样智能替换平台，使用SAM（Segment Anything Model）和DINOv2进行图像分割和特征匹配。

## 功能特点

- 🎨 **智能图像分割**：使用SAM模型自动识别图像中的不同区域
- 🔍 **特征匹配**：基于DINOv2模型进行语义特征匹配
- ⚙️ **参数调节**：用户可自主调节置信值、稳定值、相似度阈值和密度阈值
- 🎭 **掩码管理**：可视化显示所有检测到的掩码区域
- ✨ **手动替换**：支持用户手动选择掩码和替换图案
- 🖼️ **美观界面**：侗锦主题的现代化Web界面
- 💾 **结果下载**：支持下载处理后的图像

## 系统要求

- Python 3.8+
- CUDA支持的GPU（推荐）
- 至少8GB内存
- Windows 10/11

## 安装步骤

### 1. 克隆或下载项目
确保所有文件都在同一目录下：
```
AIdj/
├── app.py                    # Flask后端应用
├── f3.py                     # AI替换核心逻辑
├── templates/
│   └── index.html           # 前端界面
├── replacement_dataset1/     # 替换图案数据集
├── sam_vit_h_4b8939.pth     # SAM模型文件
├── requirements.txt         # 依赖包列表
└── README.md               # 说明文档
```

### 2. 安装Python依赖
```bash
pip install -r requirements.txt
```

### 3. 下载SAM模型（如果没有）
如果没有`sam_vit_h_4b8939.pth`文件，请从以下链接下载：
https://dl.fbaipublicfiles.com/segment_anything/sam_vit_h_4b8939.pth

### 4. 准备替换图案
确保`replacement_dataset1`文件夹中包含侗锦纹样图片（PNG/JPG格式）。

## 使用方法

### 1. 启动服务
```bash
python app.py
```

### 2. 访问网站
打开浏览器访问：http://localhost:5000

### 3. 使用流程
1. **上传图像**：点击或拖拽图像到上传区域
2. **调节参数**：
   - 置信值：SAM模型的置信度阈值（0.5-0.95）
   - 稳定值：SAM模型的稳定性阈值（0.5-0.95）
   - 相似度阈值：特征匹配的相似度阈值（0.3-0.9）
   - 密度阈值：区域密度判断阈值（0.2-0.8）
3. **自动处理**：点击"开始处理"进行AI自动替换
4. **手动调整**：在掩码管理区域选择特定掩码和替换图案进行精确替换
5. **下载结果**：点击"下载结果"保存处理后的图像

## 参数说明

### 模型参数
- **置信值（Confidence）**：控制SAM模型的检测严格程度，越高检测越严格
- **稳定值（Stability）**：影响生成掩码的质量和稳定性

### 替换策略参数
- **相似度阈值**：决定是否进行整体替换的特征相似度门槛
- **密度阈值**：影响替换策略选择的区域密度门槛

## 技术架构

- **后端**：Flask + Python
- **AI模型**：SAM (Segment Anything) + DINOv2
- **前端**：HTML5 + CSS3 + JavaScript
- **图像处理**：OpenCV + PIL
- **深度学习**：PyTorch

## 故障排除

### 常见问题

1. **模型加载失败**
   - 确保`sam_vit_h_4b8939.pth`文件存在且完整
   - 检查CUDA是否正确安装（如果使用GPU）

2. **内存不足**
   - 尝试上传较小的图像
   - 降低SAM模型的参数设置

3. **替换效果不佳**
   - 调整相似度和密度阈值
   - 使用手动替换功能进行精确控制

4. **网页无法访问**
   - 检查防火墙设置
   - 确认端口5000未被占用

### 性能优化

- 使用GPU加速（推荐NVIDIA RTX系列）
- 适当调整图像尺寸（建议不超过2048像素）
- 根据硬件配置调整批处理大小

## 开发说明

### 项目结构
- `app.py`：Flask Web应用主文件
- `f3.py`：AI替换算法核心实现
- `templates/index.html`：前端用户界面
- `replacement_dataset1/`：侗锦纹样数据集

### 扩展功能
- 支持更多图像格式
- 添加批量处理功能
- 集成更多AI模型
- 优化替换算法

## 许可证

本项目仅供学习和研究使用。

## 联系方式

如有问题或建议，请通过以下方式联系：
- 项目Issues
- 邮件联系

---

**注意**：首次运行时，系统会自动下载DINOv2模型，请确保网络连接正常。